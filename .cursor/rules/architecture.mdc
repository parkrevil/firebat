---
description: Ports & Adapters architecture and import rules for src/
globs: src/**/*.ts
alwaysApply: false
---

# Architecture Rules (src/)

## Layer Placement

| Question | Place in |
|----------|----------|
| External I/O (file/DB/network/process)? | `src/infrastructure/**` |
| Interface for external I/O? | `src/ports/**` |
| Use-case orchestration (domain rule flow)? | `src/application/**` |
| Composition root / entrypoint / DI? | `src/adapters/**` |
| Pure computation / analysis logic? | `src/engine/**` or `src/features/**` |

## Import Rules (violation = STOP)

- `src/application/**` MUST NOT import from `src/infrastructure/**` directly.
- `src/application/**` depends only on `src/ports/**`.
- `src/infrastructure/**` implements `src/ports/**`; does not depend on `src/application/**`.
- `src/adapters/**` may import from `application`, `ports`, `infrastructure` (composition).
- `src/engine/**` and `src/features/**` MUST NOT depend on external I/O.

## Naming

- `utils.ts`, `helpers.ts` are FORBIDDEN. Split by role/domain.

## Post-Change

- After ANY code change in src/, run `firebat scan` to check for quality regressions.
