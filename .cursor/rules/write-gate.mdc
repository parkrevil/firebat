---
description: File write approval gate, independent judgment rules, and STOP conditions
alwaysApply: true
---

# Write Gate & Agent Behavior

## Approval Token

The ONLY valid approval token is exactly `ㅇㅇ` (Korean ㅇ x2).

**NOT valid**: "ok", "오케이", "ㅇㅋ", "ㅇ", "yes", "확인", "좋아", "`ㅇㅇ`" (with backticks), "ㅇㅇ." (with period).

If user responds with anything other than `ㅇㅇ`, reply: "승인 토큰 `ㅇㅇ`를 정확히 입력해주세요".

## Before Requesting Approval

MUST present all three:

1. **Target**: file paths, scope, specific changes
2. **Risk**: functional impact, side effects, compatibility
3. **Alternatives**: ways to avoid the change or different approaches

## Bun-first Enforcement

When choosing Node.js or npm over Bun:

1. MUST call context7 first to verify Bun cannot do it
2. Present context7 result to user with justification
3. Get `ㅇㅇ` approval before proceeding

Skipping context7 when selecting Node/npm = policy violation.

## Independent Judgment

**MUST ask the user:**

- Choosing between implementation methods (e.g., Bun API vs Node API)
- File/code deletion or modification
- Public API changes (exports, CLI, MCP interface)
- Package dependency add/remove
- Config file option changes (.rc, config.ts, etc.)
- User intent is interpretable as "A or B"
- Scope/priority is unclear

**Allowed without asking:**

- File read order
- Temporary variable names
- Code formatting style (follow existing project conventions)
- Obvious bug fixes (type errors, syntax errors)

Guessing user intent = policy violation.

## STOP Conditions

Immediately halt when:

1. **Scope exceeded** — need to modify files outside approved scope
2. **Required MCP unavailable** — context7/sequential-thinking call failed → request MCP results from user
3. **Rule conflict** — choose the most conservative interpretation:
   - Change < keep unchanged
   - Bun < Node < npm (priority order)
   - "Needs approval" < "No approval needed" → assume needs approval
4. **Ambiguity** — ask user instead of guessing. Forbidden: "probably", "I assume"

Rule violation = immediate failure.
